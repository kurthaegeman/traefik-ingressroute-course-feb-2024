---
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: demo-product-dev-auth
  namespace: demo-product-dev
spec:
  basicAuth:
    secret: demo-product-dev-secret
---
# Note: in a kubernetes secret the string (e.g. generated by htpasswd) must be
# base64-encoded first. To create an encoded user:password pair, the following
# command can be used: htpasswd -nb user password | openssl base64
apiVersion: v1
kind: Secret
metadata:
  name: demo-product-dev-secret
  namespace: demo-product-dev
data:
  users: |2
    dXNlcjokYXByMSQ0SS8xUXhPNSR1b3VoSEdodW01eUpBRzlmWUpWOFcxCgo=
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: demo-dev-ingress
  namespace: demo-product-dev
  labels:
    demo: word
spec:
  routes:
    - kind: Rule
      match: Host(`product.nomadrail.com`) && PathPrefix(`/v2/`)
      middlewares:
        - name: demo-product-dev-auth
          namespace: demo-product-dev
        - name: demo-stripprefix
          namespace: demo-product-dev
      services:
        - kind: Service
          name: svc-demo-api
          namespace: demo-product-dev
          port: 80
